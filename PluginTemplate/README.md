# OnlineGift 在线礼包

- 作者: 星夜神花 羽学
- 出处: [OnlineGift](https://gitee.com/star-night-flower/tshock-gift)
- 这是一个Tshock服务器插件，主要用于：为在线玩家定时发放礼包


## 指令

| 语法      |    权限     |        说明        |
| --------- | :---------: | :----------------: |
| /gift list | gift |   显示当前礼包物品   |
| /gift show | gift |   显示距离下次礼包剩余时间   |
| /gift on | gift.admin |   开启插件   |
| /gift off | gift.admin |   关闭插件   |
| /gift add | gift.admin |   添加物品   |
| /gift del | gift.admin |   移除物品   |
| /gift time | gift.admin |   设置发放时间   |
| /gift rs | gift.admin |   还原默认配置   |

## 配置
> 配置文件位置：tshock/在线礼包.json
```json5
{
  "启用插件": true,
  "管理权限": "gift.admin",
  "总概率(自动更新)": 54,
  "发放秒数": 1800,
  "跳过生命上限": 500,
  "发放时的信息": "[c/55CDFF:服务器]送了你1个在线礼包",
  "礼包列表": [
    {
      "物品名称": "蠕虫罐头",
      "物品ID": 4345,
      "所占概率": 1,
      "物品数量": [
        2,
        5
      ]
    },
    {
      "物品名称": "草药袋",
      "物品ID": 3093,
      "所占概率": 1,
      "物品数量": [
        2,
        5
      ]
    }
  ]
}
```

## 更新日志
```
v1.1.2
重构代码，移除序列配置项，使用游戏更新事件触发（移除定时器）服务器无人不会更新
加入了更多指令：/gift 或 /在线礼包
增加英文权限名: gift 和 gift.admin

v1.1.1
1.完善了对“总概率”的Reload重载同步
2.优化了命令的显示排版
3.给命令加了个权限名
4.移除了配置文件里的“将未符合条件者记录后台”

v1.1.0
1.修复了使用/reload或重启服务器时，配置文件被原配置覆盖，无法正常读取修改过的变量问题。
2.把计算总概率的显示加入到了指令里：/在线礼包
3.删除配置文件使用/reload可得到个计算过的“总概率”值在配置文件里
4.配置文件加入了“跳过生命上限”的检测标准，可以决定高血量玩家无法获取在线礼包。
5.加入了每次发放礼包是否记录后台
6.“将未符合条件者记录后台”是羽学调试时观察用的，不建议开，后期更新会移除。
7.赠送礼包后会提醒玩家下次发放时间

v1.0.9
1.修复了不按时送物品的问题，  
2.移除了广播在线时长的方法，  
3.配置文件加入了大量预设物品方案，  
4.修复了/在线礼包指令不显示概率的问题，  
5.不再根据序列数量来发放物品而是发过一次自动重置为0+1从第一个序列开始发，  
6.解决了初始化配置文件时自动序列化问题  
7.加了个计算总概率的新方法。  

v1.0.8  
1.补充了配置文件缺失的变量名称  
2.增加了总概率选项  
3.玩家可自定义广播间隔时间，方便与触发时间同步  
4.再次尝试优化定时器
5.适配了.net 6.0  

v1.0.7  
1.优化了定时器  
2.config文件改名为【在线礼包.json】，并对其修改项合理汉化   
```

## 反馈
- 优先发issued -> 共同维护的插件库：https://github.com/UnrealMultiple/TShockPlugin
- 次优先：TShock官方群：816771079
- 大概率看不到但是也可以：国内社区trhub.cn ，bbstr.net , tr.monika.love
